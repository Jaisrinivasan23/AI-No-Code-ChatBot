<!-- test_chatbot.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatbot Test</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4">{{ chatbot.name }}</h2>
        <div id="chat-box" class="border p-3 mb-3" style="height: 300px; overflow-y: scroll;">
            <!-- Chat messages will appear here -->
        </div>
        <form id="chat-form" method="POST">
            {% csrf_token %}
            <div class="input-group mb-3">
                <input type="text" id="user-message" class="form-control" placeholder="Type your message..." required>
                <div class="input-group-append">
                    <button class="btn btn-primary" type="submit">Send</button>
                </div>
            </div>
        </form>
        <div class="mt-4">
            <a href="{% url 'dashboard' user.id %}" class="btn btn-info mr-2">
                <i class="fas fa-home"></i> Go to Dashboard
            </a>
            <a href="{% url 'form_based' %}" class="btn btn-warning">
                <i class="fas fa-edit"></i> Edit Chatbot
            </a>
        </div>
        <a href="/{{ chatbot.name }}/" class="btn btn-primary" target="_blank">Host Chatbot</a>
    </div>

    <script>
        $("#chat-form").on("submit", function(e) {
            e.preventDefault();
            const userMessage = $("#user-message").val();
            $("#chat-box").append(`<div><strong>You:</strong> ${userMessage}</div>`);
            $("#user-message").val(""); // Clear the input

            // Send the message to the server
            $.ajax({
                type: "POST",
                url: "{% url 'form_based_test' chatbot.id %}",
                data: {
                    'user_message': userMessage,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    const botResponse = response.bot_response;
                    $("#chat-box").append(`<div><strong>Bot:</strong> ${botResponse}</div>`);
                    $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
                },
                error: function() {
                    alert("There was an error processing your message.");
                }
            });
        });
    </script>
</body>
</html>
